import { defineStore } from 'pinia'
import axios from "axios"

// You can name the return value of `defineStore()` anything you want,
// but it's best to use the name of the store and surround it with `use`
// and `Store` (e.g. `useUserStore`, `useCartStore`, `useProductStore`)
// the first argument is a unique id of the store across your application
export const useChoreStore = defineStore('chore', {
  state: () => ({ 
    areas: [],
    chores: [],
    users: [],
    units: ['day(s)', 'week(s)', 'month(s)', 'year(s)'],
    intervals: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],
    med_thresh: 50,
    high_thresh: 90,
  }),
    getters: {
      getAreas(state){
        return state.areas
      },
      getChores(state){
        state.chores.forEach((chore) => {
          const areaid = chore.area -1
          const userid = chore.assignee -1
          chore.repeat = chore.intervalNumber + " " + chore.unit
          chore.area = state.areas[areaid].area_name
          chore.areaicon = state.areas[areaid].area_icon
          if (userid >= 0) {
            if (state.users[userid].first_name === null && state.users[userid].last_name === null) {
              chore.assignee = state.users[userid].first_name + ' ' + state.users[userid].last_name
            } else {
              chore.assignee = state.users[userid].email
            }
            chore.assignee_icon = "mdi-radiobox-marked"
            chore.isAssigned = true
          } else {
            chore.assignee = "Unassigned"
            chore.assignee_icon = "mdi-radiobox-blank"
            chore.isAssigned = false
          }
          if (chore.duedays < 0) {
            chore.isOverdue = true
          }else{
            chore.isOverdue = false
          }
          if (chore.dirtiness <= state.med_thresh ) {
            chore.dirtycolor = 'blue-grey'
          }else if (chore.dirtiness > state.med_thresh && chore.dirtiness <= state.high_thresh){
            chore.dirtycolor = 'yellow'
          }else if (chore.dirtiness > state.high_thresh){
            chore.dirtycolor = 'red'
          }
        })

        return state.chores
      },
      getUsers(state){
        return state.users
      }
    },
    actions: {
      async fetchAreas() {
        try {
          const data = await axios.get('https://chores.danielleandjohn.love/api/areas/')
          this.areas = data.data
        }
        catch (error) {
          alert(error)
          console.log(error)
        }
      },
      async fetchChores() {
        try {
          const data = await axios.get('https://chores.danielleandjohn.love/api/chores/')
          this.chores = data.data
        }
        catch (error) {
          alert(error)
          console.log(error)
        }
      },
      async fetchUsers() {
        try {
          const data = await axios.get('https://chores.danielleandjohn.love/api/users/')
          this.users = data.data
        }
        catch (error) {
          alert(error)
          console.log(error)
        }
      },
      async addArea(area) {
        try {
          // Make a POST request to your API endpoint
          const response = await axios.post('https://chores.danielleandjohn.love/api/areas/', area);

          // Add area to local storage
          //this.areas.push(area);
          this.fetchAreas();

          // Handle the response here (e.g., show a success message)
          console.log('Response:', response.data);
        } catch (error) {
          // Handle errors (e.g., show an error message)
          console.log('Error:', error);
        }
      },
      async addChore(chore) {
        try {
          // Make a POST request to your API endpoint
          const newDate = new Date()
          const today = new Date()
          if ( chore.unit == 'day(s)' ){
            newDate.setDate(today.getDate()+chore.intervalNumber)
          } else if ( chore.unit == 'week(s)' ){
            newDate.setDate(today.getDate()+(chore.intervalNumber*7))
          } else if ( chore.unit == 'month(s)' ){
            newDate.setMonth(today.getMonth()+chore.intervalNumber)
          } else if ( chore.unit == 'year(s)' ){
            newDate.setFullYear(today.getFullYear()+chore.intervalNumber)
          }

          chore.nextDue = newDate.toISOString().split('T')[0]
          const response = await axios.post('https://chores.danielleandjohn.love/api/chores/', chore);

          // Add area to local storage
          //this.chores.push(chore);
          this.fetchChores();

          // Handle the response here (e.g., show a success message)
          console.log('Response:', response.data);
        } catch (error) {
          // Handle errors (e.g., show an error message)
          console.log('Error:', error);
        }
      },
      async claimChore(chore) {
        console.log('Chore claimed', chore)
      },
      async completeChore(chore) {
        console.log('Chore completed', chore)
      },
      async snoozeChore(chore) {
        console.log('Chore snoozed', chore)
      },
      async toggleChore(chore) {
        console.log('Chore toggled', chore)
      },
      async saveChore(chore) {
        console.log('Chore saved', chore)
      },
      async deleteChore(chore) {
        console.log('Chore deleted', chore)
      },
    },
    persist: true,
  })